<!--
	How to load an image with SingleTileImageryProvider,
	it is useful especially when the quality of network is so poor
-->
<!DOCTYPE html>
<head>
    <title>Spark</title>
    <link href="./Build/Cesium/Widgets/widgets.css" rel="stylesheet">
	<script type="text/javascript" src="./src/lib/require.min.js" data-main="./src/js/main"></script>
	<script type="text/javascript" src="./src/lib/googlemaps.js"></script>
	<style>
        html, body, #cesiumContainer {
            width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
        }
    </style>
</head>

<body>
<div id="cesiumContainer"></div>
<script>
    function onload(Cesium) {
     
		var extent = Cesium.Rectangle.fromDegrees(73.666667, 3.866667, 135.041667, 53.55);
		Cesium.Camera.DEFAULT_VIEW_RECTANGLE = extent;
		var viewer = new Cesium.Viewer('cesiumContainer',{
				baseLayerPicker : false,
				imageryProvider : createGoogleMapsByUrl(Cesium,{url:"http://mt1.google.cn/vt/lyrs=s&hl=zh-CN&x={x}&y={y}&z={z}"}),
				animation : false,
				baseLayerPicker : false,
				fullscreenButton : false,
				vrButton : false,
				geocoder : false,
				homeButton : false,
				infoBox : false,
				sceneModePicker : false,
				timeline : false,
				navigationInstructionsInitiallyVisible : false,
				scene3DOnly : false,
				navigationHelpButton:false
			});
			
		viewer._cesiumWidget._creditContainer.style.display="none";
		
		viewer.scene.globe.depthTestAgainstTerrain = true;
		Cesium.Math.setRandomNumberSeed(3);
		var start = Cesium.JulianDate.fromDate(new Date(2015, 2, 25, 16));
		var stop = Cesium.JulianDate.addSeconds(start, 360, new Cesium.JulianDate());
		viewer.clock.startTime = start.clone();
		viewer.clock.stopTime = stop.clone();
		viewer.clock.currentTime = start.clone();
		viewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP; //Loop at the end
		viewer.clock.multiplier = 10;
		//viewer.timeline.zoomTo(start, stop);
		function computeCirclularFlight(lon, lat, radius) {
			var property = new Cesium.SampledPositionProperty();
			for (var i = 0; i <= 360; i += 45) {
				var radians = Cesium.Math.toRadians(i);
				var time = Cesium.JulianDate.addSeconds(start, i, new Cesium.JulianDate());
				var position = Cesium.Cartesian3.fromDegrees(lon + (radius * 1.5 * Math.cos(radians)), lat + (radius * Math.sin(radians)), 1);
				property.addSample(time, position);
				viewer.entities.add({
					position : position,
					point : {
						pixelSize : 1,
						color : Cesium.Color.TRANSPARENT,
						outlineColor : Cesium.Color.TRANSPARENT,
						outlineWidth : 1
					}
				});
			}
			return property;
		}

		var position = computeCirclularFlight(112.110693, 36.0994841, 0.03);
		var entity = viewer.entities.add({
			availability : new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({
				start : start,
				stop : stop
			})]),
			position : position,

			orientation : new Cesium.VelocityOrientationProperty(position),
			model : {
				uri : './data/CesiumMilkTruck.glb',
				minimumPixelSize : 64,
				scale : 0.01
			},
			path : {
				resolution : 1,
				material : new Cesium.PolylineGlowMaterialProperty({
					glowPower : 0.1,
					color : Cesium.Color.YELLOW
				}),
				width : 10
			}
		});

		
		viewer.trackedEntity = undefined;
		viewer.zoomTo(viewer.entities, new Cesium.HeadingPitchRange(Cesium.Math.toRadians(-90), Cesium.Math.toRadians(-15), 7500));
    };
</script>
</body>